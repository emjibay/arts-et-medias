{% extends "layouts/indexLayout.njk" %}

{% from 'macros/piece-index.njk' import articleList %}


{%- set isFirstPage = (data.currentPage === 1) -%}
{%- set hasTags = data.page.withTags|length > 0 -%}

{% block mainAdditionalClasses %}articles-index{% endblock %}

{% block pageContent %}
  {%- if isFirstPage and not hasTags -%}
    {% include "partials/articles/featured.njk" %}
    <hr class="separator" />
  {%- endif -%}

  {# pieces list #}
  {%-
    set filteredPieces = apos.aemPieces.getWithTags(
      data.articlesByPublicationDate,
      data.page.withTags
    )
  -%}
  {%-
    set piecesOnPage = apos.aemPieces.getAtPage(
      filteredPieces,
      data.currentPage
    )
  -%}
  {{ articleList(piecesOnPage) }}

  {# pagination #}
  {{
    pager.render(
      {
        page: data.currentPage,
        total: data.totalPages
      },
      data.url
    )
  }}
{% endblock %}

{% block sidebar %}
  {%- if isFirstPage -%}
    {% include "partials/articles/sidebar-no-feature-en.njk" %}
  {%- else -%}
    {% include "partials/articles/sidebar-en.njk" %}
  {%- endif -%}
{% endblock %}
