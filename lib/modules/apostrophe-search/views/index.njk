{% extends "layouts/layout.njk" %}

{%- from 'macros/metadata.njk' import minimalMetaData -%}
{%- from 'macros/piece-index.njk' import pieceListWithType -%}


{%- set hasQuery = data.query !== null and data.query.q !== '' and data.query.q !== undefined -%}
{%- set numResults = data.docs|length -%}

{% block title %}
  {{ data.page.title }} | Arts et MÃ©dias
{% endblock %}

{% block metadata %}
  {{
    minimalMetaData({
      title: data.page.title,
      url: data.page._url,
      baseUrl: data.baseUrl
    })
  }}
{% endblock %}

{% block main %}
  <div class="page-search">
    <div class="content">
      <main id="main">
        <article>
          <h1 class="sr-only">{{ data.page.title }}</h1>

          <form
            data-apos-search-page-form
            class="main-search-form"
            method="GET"
            action="{{ data.url | e }}"
          >
            <fieldset class="search-fieldset">
              <legend class="ld-meta">
                {{ __ns('apostrophe', 'New Search') }}
              </legend>
              <input
                data-apos-search-field
                class="search-input"
                type="search"
                value="{{ data.query.q | e }}"
                placeholder="Enter your search"
                name="q"
              />
              <button
                type="submit"
                class="search-button"
              >
                <img
                  class="icon"
                  src="/img/icon-search.svg"
                  alt=""
                />
                <span class="label">Search</span>
              </button>
            </fieldset>

            {#
              TODO: filters should sort results

              {% if data.filters %}
                <fieldset>
                  <legend class="filter-legend">
                    {{ __ns('apostrophe', 'Filter Results By Type') }}
                  </legend>
                  <ul class="filter-list">
                    {% for filter in data.filters %}
                      <li class="list-item">
                        <input
                          data-apos-search-filter
                          class="filter-option"
                          type="checkbox"
                          name="{{ filter.name | e }}"
                          {% if filter.value %}checked{% endif %}
                          value="1"
                        />
                        <span class="filter-option-label">
                          {{ filter.label | e }}
                        </span>
                      </li>
                    {% endfor %}
                  </ul>
                </fieldset>
              {% endif %}
              #}
          </form>

          <div class="page-content">
            <section class="search-results">
              <h2 class="title">Search Results</h2>
              {%- if numResults -%}
                {%- if hasQuery -%}
                  <p>Showing results for "{{ data.query.q }}"</p>
                {%- endif -%}
                {{ pieceListWithType(data.docs) }}
                {% include "pager.html" %}
              {%- else -%}
                <p>There are no results for "{{ data.query.q }}".</p>
                <p>Try checking your spelling or use more general terms.</p>
              {%- endif -%}
            </section>
          </div>

          {% include "partials/search/sidebar-en.njk" %}
        </article>
      </main>
    </div>
  </div>
{% endblock %}

