{% import 'apostrophe-pager:macros.html' as pager with context %}

{%- from 'macros/hero-image.njk' import heroImage -%}
{%- from 'macros/piece-details.njk' import truncatedDescription -%}


{%- macro pieceList(pieces, hasByline = false) -%}
  <ul class="piece-list">
    {% for piece in pieces %}
      <li class="list-item">
        <a
          href="{{ piece._url }}"
          class="piece-link"
        >
          <article class="piece-card">
            <p class="heading">{{ piece.title }}</p>

            {% if hasByline %}
              <ul class="byline-list">
                {% for author in piece._author %}
                  <li>
                    <p>{{ author.title }}</p>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}

            {{ truncatedDescription(piece) }}
          </article>
        </a>
      </li>
    {% endfor %}
  </ul>
{%- endmacro -%}

{%- macro articleList(pieces) -%}
  <ul class="piece-list article-list">
    {% for piece in pieces %}
      <li class="list-item">
        <a
          href="{{ piece._url }}"
          class="piece-link"
        >
          <article class="piece-card">
            <p class="heading">{{ piece.title }}</p>

            <ul class="byline-list">
              {% for author in piece._originalAuthor %}
                <li>
                  <p>{{ author.title }}</p>
                </li>
              {% endfor %}
            </ul>

            {#
              TODO: add filter to date
              SEE:
                - https://github.com/e-picas/nunjucks-date-filter
                - https://stackoverflow.com/questions/53787009/how-to-add-nunjucks-date-filter
            #}
            <p class="publication-date">{{ piece.publicationDate }}</p>

            {{ heroImage(piece) }}

            <p>{{ piece.shortDescription }}</p>
          </article>
        </a>
      </li>
    {% endfor %}
  </ul>
{%- endmacro -%}

{%- macro educationList(pieces) -%}
  <ul class="piece-list">
    {% for piece in pieces %}
      <li class="list-item">
        <a
          href="{{ piece._url }}"
          class="piece-link"
        >
          <article class="piece-card">
            <p class="heading">{{ piece.title }}</p>

            <ul class="byline-list">
              {% for org in piece._institution %}
                <li>
                  <p>{{ org.title }}, {{ org.city }}, {{ org.country }}</p>
                </li>
              {% endfor %}
            </ul>

            {{ truncatedDescription(piece) }}
          </article>
        </a>
      </li>
    {% endfor %}
  </ul>
{%- endmacro -%}

{%- macro eventList(pieces) -%}
  <ul class="piece-list">
    {% for piece in pieces %}
      <li class="list-item">
        <a
          href="{{ piece._url }}"
          class="piece-link"
        >
          <article class="piece-card">
            <p class="heading">{{ piece.title }}</p>

            <p class="org-location">
              {{ apos.aem.formatDate(piece.startDate) }}, {{ piece.city }}, {{ piece.country }}
            </p>

            {{ truncatedDescription(piece) }}
          </article>
        </a>
      </li>
    {% endfor %}
  </ul>
{%- endmacro -%}

{%- macro organizationList(pieces, hasLocation = false) -%}
  <ul class="piece-list">
    {% for piece in pieces %}
      <li class="list-item">
        <a
          href="{{ piece._url }}"
          class="piece-link"
        >
          <article class="piece-card">
            <p class="heading">{{ piece.title }}</p>

            {%- if hasLocation -%}
              <p class="org-location">{{ piece.city }}, {{ piece.country }}</p>
            {%- endif -%}

            {{ truncatedDescription(piece) }}
          </article>
        </a>
      </li>
    {% endfor %}
  </ul>
{%- endmacro -%}

{%- macro projectList(pieces) -%}
  <ul class="piece-list">
    {% for piece in pieces %}
      <li class="list-item">
        <a
          href="{{ piece._url }}"
          class="piece-link"
        >
          <article class="piece-card">
            <p class="heading">{{ piece.title }}</p>

            <ul class="byline-list">
              {% for author in piece._author %}
                <li>
                  <p>{{ author.title }}</p>
                </li>
              {% endfor %}
            </ul>

            {{ heroImage(piece) }}

            {{ truncatedDescription(piece) }}
          </article>
        </a>
      </li>
    {% endfor %}
  </ul>
{%- endmacro -%}

{%- macro mainContent(data) -%}
  <main id="main">
    <article>
      <h1>{{ data.page.title }}</h1>
      <div class="page-content">
        {{ pieceList(data.pieces) }}
        {{ pager.render({ page: data.currentPage, total: data.totalPages }, data.url) }}
      </div>
    </article>
  </main>
{%- endmacro -%}
